<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í¬ë„ìŠ¤íŠœë””ì˜¤ ì‚¬ì§„ ì¸í™” ì ‘ìˆ˜</title>
  <style>
    body {
      font-family: "Pretendard", sans-serif;
      background: linear-gradient(135deg, #ffe6f1, #e8f0ff, #e5fff6);
      background-size: 400% 400%;
      animation: gradientMove 12s ease infinite;
      margin: 0; padding: 0;
      display: flex; justify-content: center; align-items: flex-start;
      min-height: 100vh;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .container {
      width: 95%; max-width: 500px;
      background: rgba(255,255,255,0.92);
      border-radius: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      margin: 30px 0; padding: 28px;
      backdrop-filter: blur(10px);
    }
    h1 {
      text-align: center; font-size: 24px; color: #7c4dff;
      margin-bottom: 10px; font-weight: 800;
    }
    h1::before { content: "ğŸ“¸ "; }
    .section { margin-top: 25px; }
    .size-options {
      display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
    }
    .size-btn {
      padding: 10px 16px; border-radius: 12px; border: none;
      background: #f0efff; cursor: pointer; font-weight: 600; color: #555;
      transition: all 0.25s ease;
    }
    .size-btn.active {
      background: linear-gradient(135deg, #a07dff, #ff92d0); color: white;
      transform: scale(1.08); box-shadow: 0 4px 10px rgba(160,125,255,0.3);
    }
    input[type="file"] { display: block; margin: 15px auto; }
    .preview {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 10px; margin-top: 10px;
    }
    .preview img {
      width: 100px; height: 100px; object-fit: cover;
      border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .upload-btn {
      width: 100%;
      background: linear-gradient(135deg, #7c4dff, #b57cff);
      color: white; font-size: 18px; font-weight: 700;
      border: none; border-radius: 12px; padding: 14px;
      margin-top: 15px; cursor: pointer;
      transition: 0.3s ease; box-shadow: 0 4px 15px rgba(124,77,255,0.35);
      animation: glow 1.8s infinite alternate;
    }
    @keyframes glow {
      from { box-shadow: 0 0 8px rgba(124,77,255,0.3); }
      to { box-shadow: 0 0 18px rgba(255,146,208,0.6); }
    }
    .upload-btn:disabled { background: #ccc; cursor: not-allowed; animation: none; }
    .progress-bar { height: 12px; background: #e0e0e0; border-radius: 10px; margin-top: 12px; overflow: hidden; }
    .progress-fill { width: 0%; height: 100%; background: linear-gradient(135deg, #7c4dff, #ff92d0); transition: width 0.3s ease; }
    .price { margin-top: 14px; font-size: 16px; text-align: center; font-weight: 600; color: #444; }
    .note { text-align: center; margin-top: 10px; font-size: 13px; color: #777; }
  </style>
</head>
<body>
  <div class="container">
    <h1>í¬ë„ìŠ¤íŠœë””ì˜¤ ì‚¬ì§„ ì¸í™” ì ‘ìˆ˜</h1>

    <div class="section">
      <h3>1. ì¸í™” ì‚¬ì´ì¦ˆ ì„ íƒ</h3>
      <div class="size-options" id="sizeOptions">
        <button class="size-btn active" data-size="3x5">3x5</button>
        <button class="size-btn" data-size="4x6">4x6</button>
        <button class="size-btn" data-size="5x7">5x7</button>
        <button class="size-btn" data-size="6x8">6x8</button>
        <button class="size-btn" data-size="5x7cm">5x7cm</button>
        <button class="size-btn" data-size="ì—¬ê¶Œì‚¬ì§„">ì—¬ê¶Œì‚¬ì§„</button>
        <button class="size-btn" data-size="ë¯¼ì¦/ë©´í—ˆì¦">ë¯¼ì¦/ë©´í—ˆì¦</button>
      </div>
    </div>

    <div class="section">
      <h3>2. ì‚¬ì§„ ì„ íƒí•˜ê¸°</h3>
      <input type="file" id="photoInput" accept="image/*" multiple />
      <div class="preview" id="preview"></div>
    </div>

    <div class="section">
      <h3>3. ì—…ë¡œë“œ ì‹œì‘</h3>
      <div class="price" id="priceText">ì˜ˆìƒ ê¸ˆì•¡: 3,000ì›</div>
      <button id="uploadBtn" class="upload-btn" disabled>ğŸ“¤ ì—…ë¡œë“œ ì‹œì‘</button>
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="note" id="statusText">ì‚¬ì§„ì„ ì„ íƒí•˜ë©´ ì—…ë¡œë“œ ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <script>
    const photoInput = document.getElementById("photoInput");
    const preview = document.getElementById("preview");
    const uploadBtn = document.getElementById("uploadBtn");
    const progressFill = document.getElementById("progressFill");
    const statusText = document.getElementById("statusText");
    const priceText = document.getElementById("priceText");
    const sizeButtons = document.querySelectorAll(".size-btn");

    let selectedFiles = [];
    let selectedSize = "3x5";
    let thumbArray = [];

    sizeButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        sizeButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        selectedSize = btn.dataset.size;
        calcPrice();
      });
    });

    const priceTable = {
      "3x5": 500, "4x6": 500, "5x7": 5000, "6x8": 8000,
      "5x7cm": 1000, "ì—¬ê¶Œì‚¬ì§„": 15000, "ë¯¼ì¦/ë©´í—ˆì¦": 15000
    };

    function calcPrice() {
      let total = 0;
      const base = 3000;
      const count = selectedFiles.length;

      if (selectedSize === "ì—¬ê¶Œì‚¬ì§„" || selectedSize === "ë¯¼ì¦/ë©´í—ˆì¦") {
        total = count * priceTable[selectedSize];
        priceText.textContent = `ì˜ˆìƒ ê¸ˆì•¡: ${total.toLocaleString()}ì› (${count}ì¥ Ã— 15,000ì›)`;
      } else {
        const per = priceTable[selectedSize] || 0;
        total = base + count * per;
        priceText.textContent = `ì˜ˆìƒ ê¸ˆì•¡: ${total.toLocaleString()}ì› (ê¸°ë³¸ 3,000 + ${count}ì¥ Ã— ${per.toLocaleString()})`;
      }
    }

    photoInput.addEventListener("change", (e) => {
      selectedFiles = Array.from(e.target.files);
      preview.innerHTML = "";
      thumbArray = [];

      selectedFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = evt => {
          const img = document.createElement("img");
          img.src = evt.target.result;
          preview.appendChild(img);
          thumbArray.push(evt.target.result);
          localStorage.setItem("uploadedThumbs", JSON.stringify(thumbArray));
        };
        reader.readAsDataURL(file);
      });

      uploadBtn.disabled = selectedFiles.length === 0;
      statusText.textContent = "ğŸ“¸ ì¤€ë¹„ ì™„ë£Œ! ì—…ë¡œë“œë¥¼ ì‹œì‘í•˜ì„¸ìš”.";
      calcPrice();
    });

    uploadBtn.addEventListener("click", async () => {
      if (selectedFiles.length === 0) return alert("ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”.");
      uploadBtn.disabled = true;
      statusText.textContent = "ğŸ“¤ ì—…ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤...";
      progressFill.style.width = "10%";

      try {
        for (let i = 0; i < selectedFiles.length; i++) {
          const formData = new FormData();
          formData.append("photo", selectedFiles[i]);
          formData.append("size", selectedSize);
          formData.append("copies", 1);
          const res = await fetch("/api/upload", { method: "POST", body: formData });
          if (!res.ok) throw new Error("ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜");
          await res.json();
          progressFill.style.width = `${((i + 1) / selectedFiles.length) * 100}%`;
        }

        window.location.href = `/result.html?count=${selectedFiles.length}&size=${encodeURIComponent(selectedSize)}`;
      } catch (err) {
        statusText.textContent = "âš ï¸ ì˜¤ë¥˜ ë°œìƒ: " + err.message;
      } finally {
        uploadBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
